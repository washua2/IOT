<template>
  <div
    class="w-[60.1875rem] h-[9.4375rem] pt-[1.75rem] pl-[3.0625rem] pb-[1.625rem] box-border rounded-xl flex items-center"
    style="background: linear-gradient(180deg, rgba(0, 12, 17, 0.7) 0%, rgba(0, 12, 17, 0.7) 100%);">
    <!-- 左侧旋转图标 -->
    <div class="">
      <div class="">
        <svg xmlns="http://www.w3.org/2000/svg" width="5.75rem" height="5.75rem" viewBox="0 0 92 92" fill="none">
  <rect width="3" height="3" fill="#2E8799"/>
  <rect x="89" width="3" height="3" fill="#2E8799"/>
  <rect y="89" width="3" height="3" fill="#2E8799"/>
  <rect x="89" y="89" width="3" height="3" fill="#2E8799"/>
  <path d="M6.98828 46.4433H85.0089" stroke="#4E707B" stroke-width="0.5"/>
  <path d="M46.0019 7.43359V85.4542" stroke="#4E707B" stroke-width="0.5"/>
  <rect x="10.4883" y="10.4902" width="71.0206" height="71.0206" rx="35.5103" stroke="#267180" stroke-opacity="0.7" stroke-width="7"/>
  <rect x="10.4883" y="10.4902" width="71.0206" height="71.0206" rx="35.5103" stroke="#CFE0E6" stroke-width="7"/>
  <rect opacity="0.448985" x="29.8555" y="29.8555" width="32.2887" height="32.2887" rx="16.1443" stroke="#102329" stroke-width="28"/>
  <rect opacity="0.828985" x="3.5" y="3.5" width="85" height="85" rx="42.5" stroke="#597680" stroke-dasharray="57 10"/>
  <rect opacity="0.498372" x="28.9609" y="28.9609" width="34.0773" height="34.0773" rx="17.0387" stroke="#475E66" stroke-width="0.5"/>
  <rect x="16.1055" y="16.1055" width="59.7887" height="59.7887" rx="29.8943" stroke="#475E66" stroke-width="0.5"/>
  <rect opacity="0.6" x="35.3125" y="35.3145" width="21.3711" height="21.3711" rx="10.6856" stroke="#3A6573" stroke-width="7"/>
  <g filter="url(#filter0_dd_8542_105078)">
    <circle cx="46" cy="46" r="3" fill="#B3FFFF"/>
  </g>
  <path d="M46.0586 14.668V17.0444" stroke="#17E6C3"/>
  <path d="M46.0586 74.957V77.3335" stroke="#17E6C3"/>
  <path d="M77.3906 46H75.0142" stroke="#17E6C3"/>
  <path d="M17.1016 46H14.7251" stroke="#17E6C3"/>
  <path d="M42.6226 37.8929C43.3552 38.5913 44.0733 38.7635 44.777 38.4044C45.8759 37.8437 47.3942 36.8551 48.3726 36.7469V28.8677C48.3726 27.2495 47.0857 25.9363 45.5 25.9363C43.9143 25.9363 42.6274 27.2495 42.6274 28.8677V37.8929H42.6226ZM39.75 45.1033V28.8677C39.75 25.6264 42.3238 23 45.5 23C48.6762 23 51.25 25.6264 51.25 28.8677V45.1033C54.6865 47.1297 57 50.9218 57 55.2647C57 61.7472 51.8525 67 45.5 67C39.1475 67 34 61.7521 34 55.2696C34 50.9267 36.3135 47.1346 39.75 45.1033ZM46.9363 63.3358C50.5078 63.3358 53.4044 60.3798 53.4044 56.7353C53.4044 56.332 53.0815 56.0025 52.6863 56.0025C52.2911 56.0025 51.9681 56.332 51.9681 56.7353C51.9681 59.5683 49.7173 61.8701 46.9363 61.8701C46.5411 61.8701 46.2181 62.1996 46.2181 62.603C46.2181 63.0063 46.5411 63.3358 46.9363 63.3358Z" fill="url(#paint0_linear_8542_105078)"/>
  <defs>
    <filter id="filter0_dd_8542_105078" x="25" y="25" width="42" height="42" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
      <feFlood flood-opacity="0" result="BackgroundImageFix"/>
      <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/>
      <feMorphology radius="2" operator="dilate" in="SourceAlpha" result="effect1_dropShadow_8542_105078"/>
      <feOffset/>
      <feGaussianBlur stdDeviation="8"/>
      <feColorMatrix type="matrix" values="0 0 0 0 0.2 0 0 0 0 0.6 0 0 0 0 1 0 0 0 1 0"/>
      <feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_8542_105078"/>
      <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/>
      <feMorphology radius="1" operator="dilate" in="SourceAlpha" result="effect2_dropShadow_8542_105078"/>
      <feOffset/>
      <feGaussianBlur stdDeviation="1.5"/>
      <feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0.755627 0 0 0 0 1 0 0 0 1 0"/>
      <feBlend mode="normal" in2="effect1_dropShadow_8542_105078" result="effect2_dropShadow_8542_105078"/>
      <feBlend mode="normal" in="SourceGraphic" in2="effect2_dropShadow_8542_105078" result="shape"/>
    </filter>
    <linearGradient id="paint0_linear_8542_105078" x1="45.5" y1="23" x2="45.5" y2="67" gradientUnits="userSpaceOnUse">
      <stop stop-color="white"/>
      <stop offset="1" stop-color="white" stop-opacity="0.66"/>
    </linearGradient>
  </defs>
</svg>
      </div>
    </div>

    <!-- 加载状态内容 -->
    <div class="ml-[2.1875rem]">
      <!-- 状态文字 -->
      <div class="text-white text-4xl font-bold font-['Roboto'] leading-[2.925rem] tracking-wide">Initializing for Smart Response Activation</div>
      <div class="flex items-center">
        <!-- 分段加载条 -->
        <div class="progress-bar flex-[0.99] mr-[1.5625rem]">
          <div v-for="(segment, index) in segments" :key="index" class="progress-bar-segment"
            :class="{ 'filled': progress > index }"></div>
        </div>
        <!-- 进度百分比 -->
        <div>
          <span class="text-white text-4xl font-bold font-['DS-Digital'] tracking-tight">{{ Math.floor(progress /
            segments.length * 100) }} </span><span
            class="text-white text-[1.75rem] font-bold font-['Roboto'] leading-9"> %</span>
        </div>
      </div>
    </div>
  </div>
</template>

<script setup>
import { ref, onMounted, defineProps, toRefs, watch,inject} from "vue";
const {AlertStore} = inject('store')
const props = defineProps({
  count: {
    type: Number,
    required: true,
    default: 5 // 初始需要加载的资源数量
  }
})
const progress = ref(0)
const totalSegments = 50; // 分段总数
const segments = Array.from({ length: totalSegments }, (_, i) => i); // 分段数组
const interval = ref(null)
const progressMax=ref(0)
watch(() => props.count, (val) => {
  // 重置加载进度
  if(val==5){
    progressMax.value=50
  }else{
    progressMax.value=8.8*(val+1)
  }
  reload()

})

const reload = () => {
  clearInterval(interval.value);
  interval.value = null

  interval.value = setInterval(() => {
    if (progress.value < progressMax.value) {
      progress.value += 1;
    } else {
      clearInterval(interval.value); // 加载完成后停止
      interval.value = null
      AlertStore.methods.setSystemsStep("Scene2_5")

    }
  }, 70); // 控制加载速度
}


</script>

<style scoped>
/* 主容器样式 */
.loading-container {
  display: flex;
  justify-content: center;
  align-items: center;
  width: 100%;
  height: 100%;
  background-color: rgba(30, 30, 30, 0.95);
  font-family: Arial, sans-serif;
  color: white;
}

/* 加载器整体布局 */
.loading-indicator {
  display: flex;
  align-items: center;
  width: 31.25rem;
  /* 调整整体宽度 */
  gap: 0.75rem;
  /* 图标与内容的间距 */
}

/* 左侧旋转图标 */
.loading-icon {
  display: flex;
  justify-content: center;
  align-items: center;
  width: 3rem;
  height: 3rem;
}

.icon-circle {
  /* width: 1.5rem; */
  /* height: 1.5rem; */
  /* border: 0.1875rem solid #1dd4ff; */
  border-top-color: transparent;
  border-radius: 50%;
  transform-origin: center;
  animation: spin 1.2s linear infinite;
}

/* 加载内容区域 */
.loading-content {
  flex-grow: 1;
}

/* 状态描述文字 */
.loading-text {
  font-size: 1rem;
  font-weight: normal;
  margin-bottom: 0.375rem;
  color: rgba(255, 255, 255, 0.9);
}

/* 分段加载条 */
.progress-bar {
  display: flex;
  gap: 0.25rem;
}

.progress-bar-segment {
  flex: 1;
  flex-shrink: 0;
  /* 每段等宽 */
  height: 1.125rem;
  background: rgba(53, 67, 67,.7);
  /* 默认背景色 */
  transition: background-color 0.3s ease;
  /* 平滑过渡 */
}

.progress-bar-segment.filled {
  background-color: #17e5c3;
  /* 加载后的颜色 */
}

/* 百分比显示 */
.progress-percentage {
  font-size: 0.875rem;
  color: rgba(255, 255, 255, 0.75);
  text-align: right;
}

/* 旋转动画 */
@keyframes spin {
  from {
    transform: rotate(0deg);
  }

  to {
    transform: rotate(360deg);
  }
}
</style>
