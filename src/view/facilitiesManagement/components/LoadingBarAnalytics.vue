<template>
  <div
    class="w-[60.1875rem] h-[9.4375rem] pt-[1.75rem] pl-[3.0625rem] pb-[1.625rem] box-border rounded-xl flex items-center"
    style="background: linear-gradient(180deg, rgba(0, 12, 17, 0.7) 0%, rgba(0, 12, 17, 0.7) 100%);">
    <!-- 左侧旋转图标 -->
    <div class="">
      <div class="">
        <svg xmlns="http://www.w3.org/2000/svg" width="5.75rem" height="5.75rem" viewBox="0 0 92 92" fill="none">
  <rect width="3" height="3" fill="#2E8799"/>
  <rect x="89" width="3" height="3" fill="#2E8799"/>
  <rect y="89" width="3" height="3" fill="#2E8799"/>
  <rect x="89" y="89" width="3" height="3" fill="#2E8799"/>
  <path d="M6.98438 46.4433H85.005" stroke="#4E707B" stroke-width="0.5"/>
  <path d="M46.0058 7.43359V85.4542" stroke="#4E707B" stroke-width="0.5"/>
  <rect x="10.4844" y="10.4902" width="71.0206" height="71.0206" rx="35.5103" stroke="#267180" stroke-opacity="0.7" stroke-width="7"/>
  <rect x="10.4844" y="10.4902" width="71.0206" height="71.0206" rx="35.5103" stroke="#CFE0E6" stroke-width="7"/>
  <rect opacity="0.448985" x="29.8594" y="29.8555" width="32.2887" height="32.2887" rx="16.1443" stroke="#102329" stroke-width="28"/>
  <rect opacity="0.828985" x="3.5" y="3.5" width="85" height="85" rx="42.5" stroke="#597680" stroke-dasharray="57 10"/>
  <rect opacity="0.498372" x="28.9609" y="28.9609" width="34.0773" height="34.0773" rx="17.0387" stroke="#475E66" stroke-width="0.5"/>
  <rect x="16.1094" y="16.1055" width="59.7887" height="59.7887" rx="29.8943" stroke="#475E66" stroke-width="0.5"/>
  <rect opacity="0.6" x="35.3125" y="35.3145" width="21.3711" height="21.3711" rx="10.6856" stroke="#3A6573" stroke-width="7"/>
  <g filter="url(#filter0_dd_8731_89057)">
    <circle cx="46" cy="46" r="3" fill="#B3FFFF"/>
  </g>
  <path d="M46.0625 14.668V17.0444" stroke="#17E6C3"/>
  <path d="M46.0625 74.957V77.3335" stroke="#17E6C3"/>
  <path d="M77.3906 46H75.0142" stroke="#17E6C3"/>
  <path d="M17.1016 46H14.7251" stroke="#17E6C3"/>
  <path d="M49.5625 62.2876V65C57.1097 63.559 63.4562 57.4561 65 49.0645H62.2556C60.9691 55.2522 56.1663 60.5923 49.5625 62.2876Z" fill="url(#paint0_linear_8731_89057)"/>
  <path d="M58.8682 46.0868C58.8682 53.2009 53.1682 58.9269 46.0864 58.9269C39.0045 58.9269 33.2182 53.2009 33.2182 46.0868C33.2182 38.9726 38.9182 33.2466 46 33.2466C53.0818 33.2466 58.8682 38.9726 58.8682 46.0868ZM62.2364 43.3105H65C63.4455 34.8082 57.0545 28.4749 49.4545 27V29.7763C56.1045 31.5982 60.9409 37.0639 62.2364 43.3105ZM29.7636 48.6895H27C28.5545 57.1918 34.9455 63.5251 42.5455 65V62.2237C35.8955 60.4018 31.0591 54.9361 29.7636 48.6895ZM42.5455 29.9498V27.1735C34.9455 28.6484 28.5545 34.895 27 43.484H29.7636C31.0591 37.2374 35.8955 31.7717 42.5455 29.9498Z" fill="url(#paint1_linear_8731_89057)"/>
  <defs>
    <filter id="filter0_dd_8731_89057" x="25" y="25" width="42" height="42" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
      <feFlood flood-opacity="0" result="BackgroundImageFix"/>
      <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/>
      <feMorphology radius="2" operator="dilate" in="SourceAlpha" result="effect1_dropShadow_8731_89057"/>
      <feOffset/>
      <feGaussianBlur stdDeviation="8"/>
      <feColorMatrix type="matrix" values="0 0 0 0 0.2 0 0 0 0 0.6 0 0 0 0 1 0 0 0 1 0"/>
      <feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_8731_89057"/>
      <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/>
      <feMorphology radius="1" operator="dilate" in="SourceAlpha" result="effect2_dropShadow_8731_89057"/>
      <feOffset/>
      <feGaussianBlur stdDeviation="1.5"/>
      <feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0.755627 0 0 0 0 1 0 0 0 1 0"/>
      <feBlend mode="normal" in2="effect1_dropShadow_8731_89057" result="effect2_dropShadow_8731_89057"/>
      <feBlend mode="normal" in="SourceGraphic" in2="effect2_dropShadow_8731_89057" result="shape"/>
    </filter>
    <linearGradient id="paint0_linear_8731_89057" x1="46" y1="27" x2="46" y2="65" gradientUnits="userSpaceOnUse">
      <stop stop-color="white"/>
      <stop offset="1" stop-color="white" stop-opacity="0.66"/>
    </linearGradient>
    <linearGradient id="paint1_linear_8731_89057" x1="46" y1="27" x2="46" y2="65" gradientUnits="userSpaceOnUse">
      <stop stop-color="white"/>
      <stop offset="1" stop-color="white" stop-opacity="0.66"/>
    </linearGradient>
  </defs>
</svg>
      </div>
    </div>

    <!-- 加载状态内容 -->
    <div class="ml-[2.1875rem]">
      <!-- 状态文字 -->
      <div class="w-[44.9375rem] text-white text-4xl font-bold font-['Roboto'] leading-[2.925rem] tracking-wide">Initiating Real-Time Analytics</div>
      <div class="flex items-center">
        <!-- 分段加载条 -->
        <div class="progress-bar flex-[0.99] mr-[1.5625rem]">
          <div v-for="(segment, index) in segments" :key="index" class="progress-bar-segment"
            :class="{ 'filled': progress > index }"></div>
        </div>
        <!-- 进度百分比 -->
        <div>
          <span class="text-white text-4xl font-bold font-['DS-Digital'] tracking-tight">{{ Math.floor(progress /
            segments.length * 100) }} </span><span
            class="text-white text-[1.75rem] font-bold font-['Roboto'] leading-9"> %</span>
        </div>
      </div>
    </div>
  </div>
</template>

<script setup>
import { ref, onMounted, defineProps, toRefs, watch ,inject} from "vue";
const {AlertStore} = inject('store')
const props = defineProps({
  count: {
    type: Number,
    required: true,
    default: 5 // 初始需要加载的资源数量
  }
})
const progress = ref(0)
const totalSegments = 50; // 分段总数
const segments = Array.from({ length: totalSegments }, (_, i) => i); // 分段数组
const interval = ref(null)
const progressMax=ref(0)
watch(() => props.count, (val) => {
  // 重置加载进度
  
  if(val==5){
    progressMax.value=50
  }else{
    progressMax.value=8.8*(val+1)
  }
  reload()

})

const reload = () => {
  clearInterval(interval.value);
  interval.value = null

  interval.value = setInterval(() => {
    if (progress.value < progressMax.value) {
      progress.value += 0.5;
    } else {
      console.log("加载完成0------",progress.value,progressMax.value)
      clearInterval(interval.value); // 加载完成后停止
      interval.value = null
      AlertStore.methods.setSystemsStep("Scene2_4")
    }
  }, 70); // 控制加载速度
}

</script>

<style scoped>
/* 主容器样式 */
.loading-container {
  display: flex;
  justify-content: center;
  align-items: center;
  width: 100%;
  height: 100%;
  background-color: rgba(30, 30, 30, 0.95);
  font-family: Arial, sans-serif;
  color: white;
}

/* 加载器整体布局 */
.loading-indicator {
  display: flex;
  align-items: center;
  width: 31.25rem;
  /* 调整整体宽度 */
  gap: 0.75rem;
  /* 图标与内容的间距 */
}

/* 左侧旋转图标 */
.loading-icon {
  display: flex;
  justify-content: center;
  align-items: center;
  width: 3rem;
  height: 3rem;
}

.icon-circle {
  /* width: 1.5rem; */
  /* height: 1.5rem; */
  /* border: 0.1875rem solid #1dd4ff; */
  border-top-color: transparent;
  border-radius: 50%;
  transform-origin: center;
  animation: spin 1.2s linear infinite;
}

/* 加载内容区域 */
.loading-content {
  flex-grow: 1;
}

/* 状态描述文字 */
.loading-text {
  font-size: 1rem;
  font-weight: normal;
  margin-bottom: 0.375rem;
  color: rgba(255, 255, 255, 0.9);
}

/* 分段加载条 */
.progress-bar {
  display: flex;
  gap: 0.25rem;
}

.progress-bar-segment {
  flex: 1;
  flex-shrink: 0;
  /* 每段等宽 */
  height: 1.125rem;
  background: rgba(53, 67, 67,.7);
  /* 默认背景色 */
  transition: background-color 0.3s ease;
  /* 平滑过渡 */
}

.progress-bar-segment.filled {
  background-color: #17e5c3;
  /* 加载后的颜色 */
}

/* 百分比显示 */
.progress-percentage {
  font-size: 0.875rem;
  color: rgba(255, 255, 255, 0.75);
  text-align: right;
}

/* 旋转动画 */
@keyframes spin {
  from {
    transform: rotate(0deg);
  }

  to {
    transform: rotate(360deg);
  }
}
</style>
